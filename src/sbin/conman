#!/bin/bash
  
xname=$(nid2xname $1)
if [[ -z "$xname" ]]; then
  echo "Do not understand $1" 1>&2
  exit 1
fi

conpods=$(kubectl -n services get pod -l app.kubernetes.io/name=cray-console-node 2> /dev/null | awk '{print $1}')
CONTAINER=cray-console-node
if [[ -z "$conpods" ]]; then
    conpods=$(kubectl -n services get pod -l app.kubernetes.io/name=cray-conman -o jsonpath='{.items[].metadata.name}')
    CONTAINER=cray-conman
fi
if [[ -z "$conpods" ]]; then
    echo "ERROR! conman pod can't be located!"
    exit 1
fi

for pod in $conpods; do
    kubectl -n services exec -it $pod -c $CONTAINER -- conman -j ${xname}
done

